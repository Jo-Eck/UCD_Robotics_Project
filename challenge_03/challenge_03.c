#pragma config(Sensor, S1,     touchSensor,    sensorEV3_Touch)
#pragma config(Sensor, S2,     colorSensor,    sensorEV3_Color, modeEV3Color_Color)
#pragma config(Sensor, S3,     gyroArm,        sensorEV3_Gyro)
#pragma config(Sensor, S4,     gyroTilt,       sensorEV3_Gyro)
#pragma config(Motor,  motorA,          clampMotor,    tmotorEV3_Large, PIDControl, encoder)
#pragma config(Motor,  motorB,          armMotor,      tmotorEV3_Large, PIDControl, driveLeft, encoder)
#pragma config(Motor,  motorC,          baseMotor,     tmotorEV3_Large, PIDControl, driveRight, encoder)
//*!!Code automatically generated by 'ROBOTC' configuration wizard               !!*//
void startResets();
void liftArmUp(int motorTarget);
void liftArmDown(int motorTarget);
//void doSweepSearch();
void retrieveAndPlaceObject();
void openClamp();
void closeClamp();
void startMotion();

int baseMotorSpeed = 50;
int armMotorSpeed = 30;
int clampMotorSpeed = 30;
TLegoColors target_colour = colorRed;
int objectSeen = 0;
//boolean baseRotatedLeft = false; //helps keep track of which way the arm has moved
//boolean baseRotatedRight = false;

//sets all encoders at start to 0 for all motors, to accurately measure angles
void startResets(){
    resetMotorEncoder(baseMotor);
    resetMotorEncoder(armMotor);
    resetMotorEncoder(clampMotor);
}

void resetGyros()
{
    resetGyro(gyroArm);
    resetGyro(gyroTilt);
}


/*void doSweepSearch(){
    setMotorTarget(baseMotor, 700, baseMotorSpeed);
    wait1Msec(3000);
    startResets();
    setMotorTarget(baseMotor, , baseMotorSpeed);
    wait1Msec(3000);
    rotateBase(3000000); //sweep left
    wait1Msec(3000);
    rotateBase(0); //return to base
}
*/
//pass +ve speed for rotate right, -ve speed for rotate left
//returns to start position based on touch sensor
//void rotateBaseToStart(int speed){
//
//}

//pass +ve motorTarget to lift arm, -ve motorTarget to drop arm, 0 to reset to position
void liftArmUp(int motorTarget)
{
    setMotorTarget(armMotor, -motorTarget, armMotorSpeed); //rotate to desired angle
    wait1Msec(3000);
}

void liftArmDown(int motorTarget)
{
    setMotorTarget(armMotor,motorTarget, armMotorSpeed);
    wait1Msec(3000);
}


void closeClamp()
{
    setMotorTarget(clampMotor, 100, clampMotorSpeed);
    wait1Msec(3000);
}

void openClamp()
{
    setMotorTarget(clampMotor, -100, clampMotorSpeed);
    wait1Msec(3000);
}

void retrieveAndPlaceObject(){
    startResets();
    openClamp();
    liftArmDown(220);
    startResets();
    closeClamp();
    startResets();
    liftArmUp(300);

}
void startMotion()
{
    startResets();
    liftArmUp(300);
    startResets();
    closeClamp();
}
task main()
{
    /* main steps:
     * 1: rotate right and left until clamp either sees an object or rotation hits 180/-180
     * 2: if object seen, rotate armMotor down
     * 4: run clampMotor to clamp object
     * 5: rotate armMotor up
     * 6: rotate base back to start position
     * 7: rotate armMotor down
     * 8: unclamp to drop object
     * 9: reset robot: lift arm up to base, start program again
     */

    resetGyros();
    startMotion();
    retrieveAndPlaceObject();
}